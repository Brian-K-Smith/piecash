language: python

python:
- '2.7'
- '3.3'
- '3.4'
- '3.5'

services:
- postgresql
- mysql

before_install:
 - wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
 - chmod +x miniconda.sh
 - ./miniconda.sh -b
 - export PATH=/home/travis/miniconda/bin:$PATH
 - conda update --yes conda
 # The next couple lines fix a crash with multiprocessing on Travis and are not specific to using Miniconda
 - sudo rm -rf /dev/shm
 - sudo ln -s /run/shm /dev/shm


install:
 - deps='pip sqlalchemy pandas sphinx'
 - conda install --yes $deps "python=$TRAVIS_PYTHON_VERSION"
 - export PATH=$HOME/py/bin:$PATH
 # install your own package into the environment
 - pip install -r requirements-dev.txt
 - pip install coveralls

script:
 - python setup.py test
 - coverage run --source=piecash setup.py test

after_success:
  coveralls

sudo: false

deploy:
  provider: pypi
  user: sdementen
  password:
    secure: kIW3wjCwmXVO5XyCU9SjT4NZxAcq/9XBjHKN5HuD8ACZzlaqxU3UI8YKTE3O8XFNaT56/6bySLDrR83O4+s7bcIW/tWacky5PqKSkTuYhyQfnggHn4EQC5iDBSYYONPIBwIMb28pCLps3HMAT2F868iGHpFge7hr+YQBwZ5O1Io=
  on:
    repo: sdementen/piecash
    tags: true
    all_branches: master
    condition: $PYTHON_VERSION=3.4
